@inherits LayoutComponentBase
@inject NavigationManager NavigationManager

<nav class="navbar-custom">
    <a href="/" class="navbar-brand d-flex align-items-center">
        <img src="shopimotologo.png" alt="Shopimoto" height="55" class="me-2" />
    </a>

    <div class="nav-links">
        <a href="/" class="nav-link @(IsActive("/") ? "active" : "")">Home</a>
        
        <AuthorizeView Roles="Seller">
            <a href="/seller/dashboard" class="nav-link @(IsActive("/seller/dashboard") ? "active" : "")">Dashboard</a>
        </AuthorizeView>

        <AuthorizeView>
            <Authorized>
                <div class="d-flex align-items-center gap-3">
                    <a href="/cart" class="text-decoration-none text-dark d-flex align-items-center gap-2">
                        <i class="bi bi-cart3 fs-5"></i>
                        Cart 
                    </a>
                    
                    <div class="dropdown">
                        <button class="btn btn-link nav-link dropdown-toggle text-dark p-0 d-flex align-items-center gap-2 text-decoration-none" type="button" id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                            @{
                                var profilePic = context.User.FindFirst("ProfilePictureUrl")?.Value;
                                var name = context.User.Identity?.Name;
                                if (string.IsNullOrEmpty(profilePic))
                                {
                                    <img src="@($"https://ui-avatars.com/api/?name={name}&background=random")" alt="Profile" class="rounded-circle" width="32" height="32" />
                                }
                                else
                                {
                                    <img src="@profilePic" alt="Profile" class="rounded-circle" width="32" height="32" style="object-fit: cover;" />
                                }
                            }
                            <span class="small fw-medium">@name</span>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end shadow border-0 mt-2" aria-labelledby="userDropdown">
                            <li><a class="dropdown-item py-2" href="/settings"><i class="bi bi-gear me-2"></i>Settings</a></li>
                            <li><a class="dropdown-item py-2" href="/orders"><i class="bi bi-box-seam me-2"></i>My Orders</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item py-2 text-danger" href="/logout"><i class="bi bi-box-arrow-right me-2"></i>Logout</a></li>
                        </ul>
                    </div>
                </div>
            </Authorized>
            <NotAuthorized>
                <a href="/login" class="nav-link @(IsActive("/login") ? "active" : "")">Login</a>
                <a href="/register" class="btn btn-primary btn-sm py-2 px-4">Get Started</a>
            </NotAuthorized>
        </AuthorizeView>
    </div>
</nav>

<!-- Content -->
<main class="container py-4 animate-fade-in">
    @Body
</main>

<footer class="text-center py-4 mt-auto">
    <p class="text-muted small">© @DateTime.Now.Year Shopimoto. Crafted with precision.</p>
</footer>

@code {
    private bool IsActive(string href)
    {
        var relativePath = NavigationManager.ToBaseRelativePath(NavigationManager.Uri);
        // Clean up href
        var cleanHref = href.TrimStart('/');
        // Default to home match if both empty
        if (string.IsNullOrEmpty(relativePath) && string.IsNullOrEmpty(cleanHref)) return true;
        
        // Exact match
        if (string.Equals(relativePath, cleanHref, StringComparison.OrdinalIgnoreCase)) return true;
        
        return false;
    }
}
